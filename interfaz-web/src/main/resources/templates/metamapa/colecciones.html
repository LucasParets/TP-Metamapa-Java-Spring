<html lang="es" th:replace="~{layout/base :: html}">
    <div th:fragment="contenido" style="background-color: #FDFDFD">
        <div class="lista-colecciones">
            <div class="container">
                <div class="header-colecciones">
                    <div th:unless="${esMetamapa != null && esMetamapa}" class="search-container">
                        <div class="search-bar" th:object="${filtros}">
                            <label for="q"></label>
                            <input id="q" type="text" name="q" placeholder="Buscar hechos..." th:field="*{q}"/>
                            <input type="hidden" name="page" value="0"/>
                            <button type="button" class="icon search" onclick="buscar()" aria-label="Buscar">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="8" cy="8" r="6"></circle>
                                    <line x1="14" y1="14" x2="20" y2="20"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <h2 th:if="${esMetamapa != null && esMetamapa}">Colecciones externas</h2>

                <h2 style="color: #a80404; margin-top: 20px;" th:if="${colecciones.isEmpty() || colecciones == null}">
                    No se pudieron encontrar colecciones.
                </h2>

                <div class="collection-item" th:each="coleccion : ${colecciones}">
                    <div class="description">
                        <strong th:text="${coleccion.titulo}">Título colección</strong>
                        <p th:text="${coleccion.descripcion}">Descripción de la colección</p>
                    </div>
                    <a th:unless="${esMetamapa != null && esMetamapa}" th:href="@{/colecciones/{handle}/hechos(handle=${coleccion.handle})}">Ver hechos</a>
                    <a th:if="${esMetamapa != null && esMetamapa}" th:href="@{/metamapa/colecciones/{handle}/hechos(handle=${coleccion.handle},metamapa=${coleccion.instanciaMetamapa})}">Ver hechos</a>
                </div>

                <div th:replace="~{fragments/pagination :: pagination}"></div>
            </div>
        </div>
        <script th:inline="javascript">
            document.getElementById('q').addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    buscar();
                }
            });

            function buscar() {
                const u = new URL(window.location);
                let v = document.getElementById('q').value;

                if (v) {
                    v = v.trim();
                    if (v !== '' && v.length >= 3)
                        u.searchParams.set('q', v);
                }
                else u.searchParams.delete('q');

                u.searchParams.set('page', '0');

                window.location = u.pathname + '?' + u.searchParams.toString();
            }
        </script>
    </div>
</html>